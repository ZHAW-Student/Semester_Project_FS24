<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Saskia Gianola and Sarah Wirth">

<title>Differentiation of walking patterns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Differentiation of walking patterns</h1>
<p class="subtitle lead">An attempt to differntiate walking patterns based on attributes and context information Work for the module Patterns and Trends FS24</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Saskia Gianola and Sarah Wirth </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Preprocessing for Attribute based classification</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># used libraries #### </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"XML"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"leaflet"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tmap"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readr"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"trajr"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"yardstick"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"caret"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"DiagrammeR"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"png"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"DiagrammeRsvg"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"magrittr"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rsvg"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readr"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rpart"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"stringr"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocessing ####</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># read training activities</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>training_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"activities/."</span>, <span class="at">pattern =</span> <span class="st">"*.gpx"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(training_files)){</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"act"</span>, i)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  wd <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"activities/"</span>, training_files[i])</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(filename, <span class="fu">htmlTreeParse</span>(<span class="at">file =</span> wd, <span class="at">useInternalNodes =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># function to parse activities and write into data frame</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>built_df <span class="ot">&lt;-</span> <span class="cf">function</span>(activity) {</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get coordinates</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">xpathSApply</span>(<span class="at">doc =</span> activity, <span class="at">path =</span> <span class="st">"//trkpt"</span>, <span class="at">fun =</span> xmlAttrs)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get elevation</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  elevation <span class="ot">&lt;-</span> <span class="fu">xpathSApply</span>(<span class="at">doc =</span> activity, <span class="at">path =</span> <span class="st">"//trkpt/ele"</span>, <span class="at">fun =</span> xmlValue)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get time</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">xpathApply</span>(<span class="at">doc =</span> activity, <span class="at">path =</span> <span class="st">"//trkpt/time"</span>, <span class="at">fun =</span> xmlValue)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">as.numeric</span>(coords[<span class="st">"lat"</span>, ]),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">as.numeric</span>(coords[<span class="st">"lon"</span>, ]),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">ts_POSIXct =</span> <span class="fu">ymd_hms</span>(time, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">elevation =</span> <span class="fu">as.numeric</span>(elevation)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># convert files to dataframe</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>act1_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act1)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>act2_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act2)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>act3_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act3)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>act4_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act4)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>act5_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act5)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>act6_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act6)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>act7_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act7)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>act8_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act8)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>act9_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act9)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>act10_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act10)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>act11_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act11)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>act12_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(act12)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co"># assign ID and description to single files</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>act1_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_1"</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>act1_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Waedenswil_Reidbach_Zentrum"</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>act2_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_2"</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>act2_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Waedenswil_Coop_Bahnhof"</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>act3_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_3"</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>act3_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Waedenswil_Schloss_Mensa"</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>act4_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_4"</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>act4_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Waedenswil_Gruental_Bahnhof1"</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>act5_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_5"</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>act5_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Waedenswil_Gruental_Bahnhof2"</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>act6_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_6"</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>act6_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Rueti_Home_Bahnhof_Coop_Home"</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>act7_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_7"</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>act7_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_test_Rapperswil_See_Bahnhof"</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>act8_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_8"</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>act8_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Rueti_Home_Coop_Home"</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>act9_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_9"</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>act9_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Neuhausen_Bahnhof_Rhein"</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>act10_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_10"</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>act10_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Neuhausen_Rhein_Bahnhof"</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>act11_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_11"</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>act11_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_S-chanf"</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>act12_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"test_12"</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>act12_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"test_Regensdorf_Buero_Coop"</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="co"># function to convert data frame into sf object</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>df_to_sf <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span> , <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all activitites into one data frame</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>training_activities_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(act1_df, act2_df, act3_df, act4_df, act5_df, act6_df, act7_df, act8_df, act9_df, act10_df, act11_df, act12_df)</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co"># turn data frame into sf object</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>training_activities_sf <span class="ot">&lt;-</span> <span class="fu">df_to_sf</span>(training_activities_df)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co"># export sf object for setting attributes in GIS</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="co"># export_test_activities &lt;- st_write(test_activities_sf, "test_activities.shp")</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="co"># read Saskias activities</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>saskia_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"activities/activities_saskia."</span>, <span class="at">pattern =</span> <span class="st">"*.gpx"</span>)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(saskia_files)){</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"saskia_"</span>, i)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  wd <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"activities/activities_saskia/"</span>, saskia_files[i])</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(filename, <span class="fu">htmlTreeParse</span>(<span class="at">file =</span> wd, <span class="at">useInternalNodes =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co"># convert files to dataframe</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>saskia_1_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(saskia_1)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>saskia_2_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(saskia_2)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>saskia_3_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(saskia_3)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>saskia_4_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(saskia_4)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>saskia_5_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(saskia_5)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>saskia_6_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(saskia_6)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co"># assign ID to single files</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>saskia_1_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"saskia__1"</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>saskia_1_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"saskia_Pfaeffikon_Seedamm1"</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>saskia_2_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"saskia__2"</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>saskia_2_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"saskia_Pfaeffikon_Seedamm2"</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>saskia_3_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"saskia__3"</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>saskia_3_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"saskia_Regensdorf_Buero_Bahnhof"</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>saskia_4_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"saskia__4"</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>saskia_4_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"saskia_Rueti_Zentrum_Home"</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>saskia_5_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"saskia__5"</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>saskia_5_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"saskia_Rueti_Home_Bahnhof_Coop_Home"</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>saskia_6_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"saskia__6"</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>saskia_6_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"saskia_Waedenswil_Gruental_Bhf"</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all activitites to one data frame</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>activities_saskia_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(saskia_1_df, saskia_2_df, saskia_3_df, saskia_4_df, saskia_5_df, saskia_6_df)</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="co"># turn data frame into sf object</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>activities_saskia_sf <span class="ot">&lt;-</span> <span class="fu">df_to_sf</span>(activities_saskia_df)</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="co"># export sf object for setting attributes in GIS</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="co"># export_activities_saskia &lt;- st_write(activities_saskia_sf, "activities_saskia.csv")</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a><span class="co"># read Sarahs activities</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>sarah_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"activities/activities_sarah"</span>, <span class="at">pattern =</span> <span class="st">"*.gpx"</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sarah_files)){</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"sarah_"</span>, i)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  wd <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"activities/activities_sarah/"</span>, sarah_files[i])</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(filename, <span class="fu">htmlTreeParse</span>(<span class="at">file =</span> wd, <span class="at">useInternalNodes =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a><span class="co"># convert files to dataframe</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>sarah_1_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_1)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>sarah_2_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_2)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>sarah_3_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_3)</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>sarah_4_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_4)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>sarah_5_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_5)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>sarah_6_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_6)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>sarah_7_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_7)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>sarah_8_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_8)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>sarah_9_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_9)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>sarah_10_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_10)</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>sarah_11_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_11)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>sarah_12_df <span class="ot">&lt;-</span> <span class="fu">built_df</span>(sarah_12)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="co"># assign ID and description to single files</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>sarah_1_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__1"</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>sarah_1_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Denner_Einkauf"</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>sarah_2_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__2"</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>sarah_2_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Klafi_Feld"</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>sarah_3_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__3"</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>sarah_3_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Klafi_von_Zug_Heim"</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>sarah_4_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__4"</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>sarah_4_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Migros_groesserer_Einkauf"</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>sarah_5_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__5"</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>sarah_5_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Migros_kleiner_Einkauf"</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>sarah_6_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__6"</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>sarah_6_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Rosengarten_und_Shopping_Winti"</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>sarah_7_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__7"</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>sarah_7_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Spaziergang_am_Morgen_Bub"</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>sarah_8_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__8"</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>sarah_8_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Spaziergang_Klafi_kleine_Runde"</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>sarah_9_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__9"</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>sarah_9_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_WB_Heim"</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>sarah_10_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__10"</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>sarah_10_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Zu_Bus_Klafi"</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>sarah_11_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__11"</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>sarah_11_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Zum_Bus_Bub"</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>sarah_12_df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="st">"sarah__12"</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>sarah_12_df<span class="sc">$</span>ID_text <span class="ot">&lt;-</span> <span class="st">"sarah_Zum_Zug_Liestal"</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all activities to one data frame</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>activities_sarah_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sarah_1_df, sarah_2_df, sarah_3_df, sarah_4_df, sarah_5_df, sarah_6_df,sarah_7_df,sarah_8_df,sarah_9_df, sarah_10_df, sarah_11_df,sarah_12_df)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a><span class="co"># turn data frame into sf object</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>activities_sarah_sf <span class="ot">&lt;-</span> <span class="fu">df_to_sf</span>(activities_sarah_df)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a><span class="co">#create new row for activity- classification and classify trajectories with only one activity</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>activities_sarah_sf<span class="ot">&lt;-</span>activities_sarah_sf <span class="sc">|&gt;</span> </span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Attribut =</span> <span class="fu">case_when</span>(ID_text <span class="sc">==</span> <span class="st">"sarah_Denner_Einkauf"</span> <span class="sc">~</span> <span class="st">"recreation"</span>, </span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Spaziergang_am_Morgen_Bub"</span><span class="sc">~</span> <span class="st">"recreation"</span>,</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Spaziergang_Klafi_kleine_Runde"</span>  <span class="sc">~</span> <span class="st">"recreation"</span>, </span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Klafi_von_Zug_Heim"</span>  <span class="sc">~</span> <span class="st">"travel"</span>,</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_WB_Heim"</span><span class="sc">~</span> <span class="st">"travel"</span>,</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Zu_Bus_Klafi"</span><span class="sc">~</span> <span class="st">"travel"</span>,</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Zum_Bus_Bub"</span><span class="sc">~</span> <span class="st">"travel"</span>,</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Zum_Zug_Liestal"</span><span class="sc">~</span> <span class="st">"travel"</span>,</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Klafi_Feld"</span><span class="sc">~</span> <span class="st">"recreation"</span> ,</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Migros_groesserer_Einkauf"</span><span class="sc">~</span> <span class="st">"recreation"</span>,</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Migros_kleiner_Einkauf"</span><span class="sc">~</span> <span class="st">"recreation"</span> ,</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>                              ID_text <span class="sc">==</span> <span class="st">"sarah_Rosengarten_und_Shopping_Winti"</span><span class="sc">~</span> <span class="st">"recreation"</span>  ))</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a><span class="co"># export sf object for setting attributes in GIS</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a><span class="co"># export_activities_sarah &lt;- st_write(activities_sarah_sf, "activities_sarah.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Preprocessing CAMA based classification</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We decide not to let this chunk run as it relies on the swissTLM3 dataset and therefore takes quite long to run. All outputs generated from those steps are included in the code chunk for the CAMA based classification</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">##Prepare clip data----</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>gemeindegrenzen <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"swissBOUNDARIES3D_1_5_LV95_LN02.gpkg"</span>,<span class="st">"tlm_hoheitsgebiet"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>gemeindeselection <span class="ot">&lt;-</span>gemeindegrenzen <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Andelfingen"</span>,<span class="st">"Bubendorf"</span>,<span class="st">"Freienbach"</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="st">"Kleinandelfingen"</span>,<span class="st">"Liestal"</span> ,<span class="st">"Neuhausen am</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">                                     Rheinfall"</span>,<span class="st">"Rapperswil-Jona"</span>,<span class="st">"Regensdorf"</span>,<span class="st">"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">                                     Rüti"</span>,<span class="st">"St. Moritz"</span>,<span class="st">"S-chanf"</span>,<span class="st">"Wädenswil"</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                                     ,<span class="st">"Winterthur"</span>,<span class="st">"Zuoz"</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">##Reading, clipping and exporting clipped layers----</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_layers</span>(<span class="st">"SWISSTLM3D_2024_LV95_LN02.gpkg"</span>)<span class="co">#see all contents of geopackage</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="do">################### Warning! This does take some time.  </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>gebaeude <span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"SWISSTLM3D_2024_LV95_LN02.gpkg"</span>,<span class="st">"tlm_bauten_gebaeude_footprint"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>gebaeude_selection<span class="ot">&lt;-</span><span class="fu">st_intersection</span>(gebaeude,gemeindeselection)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(gebaeude)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(gebaeude_selection, <span class="at">dsn=</span><span class="st">"CAMA_data/gebaeude_selection.gpkg"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>bodenbedeckung <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"SWISSTLM3D_2024_LV95_LN02.gpkg"</span>,<span class="st">"tlm_bb_bodenbedeckung"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>bodenbedeckung_selection<span class="ot">&lt;-</span><span class="fu">st_intersection</span>(bodenbedeckung,gemeindeselection)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(bodenbedeckung)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(bodenbedeckung_selection, <span class="at">dsn=</span><span class="st">"CAMA_data/bodenbedeckung_selection.gpkg"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>nutzungsareal <span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"SWISSTLM3D_2024_LV95_LN02.gpkg"</span>,<span class="st">"tlm_areale_nutzungsareal"</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>nutzungsareal_selection<span class="ot">&lt;-</span><span class="fu">st_intersection</span>(nutzungsareal,gemeindeselection)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(nutzungsareal)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(nutzungsareal_selection, <span class="at">dsn=</span><span class="st">"CAMA_data/nutzungsareal_selection.gpkg"</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>strassen <span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"SWISSTLM3D_2024_LV95_LN02.gpkg"</span>,<span class="st">"tlm_strassen_strasse"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>strassen_selection<span class="ot">&lt;-</span><span class="fu">st_intersection</span>(strassen,gemeindeselection)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(strassen)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(strassen_selection, <span class="at">dsn=</span><span class="st">"CAMA_data/strassen_selection.gpkg"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>oev <span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"SWISSTLM3D_2024_LV95_LN02.gpkg"</span>,<span class="st">"tlm_oev_haltestelle"</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>oev_selection<span class="ot">&lt;-</span><span class="fu">st_intersection</span>(oev,gemeindeselection)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(oev)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(oev_selection, <span class="at">dsn=</span><span class="st">"CAMA_data/oev_selection.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Attribute based classification</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attribute-based classification for training data ####</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import csv with attributes and convert to sf</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>training_activities_attributed <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"test_activities_attributiert.csv"</span>, <span class="st">","</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> <span class="fu">df_to_sf</span>(training_activities_attributed)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># change crs of sf and specify attributes</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(training_activities_attributed_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">DateTime =</span> <span class="fu">as.POSIXct</span>(ts_POSIXct),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Attribute_factor =</span> <span class="fu">as.factor</span>(Attribut)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate attributes </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate time lag  </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>difftime_secs <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(later, now, <span class="at">units =</span> <span class="st">"secs"</span>))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">timelag_sec =</span> <span class="fu">difftime_secs</span>(<span class="fu">lead</span>(DateTime,), DateTime)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate distance between locations</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>distance_by_element <span class="ot">&lt;-</span> <span class="cf">function</span>(later, now){</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_distance</span>(later, now, <span class="at">by_element =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">steplenght =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry), geometry)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Check plausibility of calculated parameters</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(training_activities_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(training_activities_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(training_activities_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(training_activities_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(training_activities_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(training_activities_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"># based on this check, remove all timelag &gt; 5 and steplenght &gt; 5</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>outliers_training_timelag <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, timelag_sec <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf[<span class="fu">which</span>(training_activities_attributed_sf<span class="sc">$</span>timelag_sec <span class="sc">&lt;=</span> <span class="dv">5</span>),]</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>outliers_training_steplenght <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, steplenght <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf[<span class="fu">which</span>(training_activities_attributed_sf<span class="sc">$</span>steplenght <span class="sc">&lt;=</span> <span class="dv">5</span>),]</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># plot again to make sure it's better</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(training_activities_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(training_activities_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(training_activities_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(training_activities_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Segmentation</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify a temporal window for mean step</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">nMinus2 =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry, <span class="dv">2</span>), geometry),  </span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">nMinus1 =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry, <span class="dv">1</span>), geometry),  </span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPlus1  =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lead</span>(geometry, <span class="dv">1</span>)), </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPlus2  =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lead</span>(geometry, <span class="dv">2</span>))  </span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean step</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> <span class="fu">mean</span>(<span class="fu">c</span>(nMinus2, nMinus1, nPlus1, nPlus2))</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean speed</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">speedMean =</span> stepMean<span class="sc">/</span>timelag_sec</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore mean step to define threshold </span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(training_activities_attributed_sf<span class="sc">$</span>stepMean)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(training_activities_attributed_sf<span class="sc">$</span>stepMean)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(training_activities_attributed_sf<span class="sc">$</span>stepMean)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="co"># apply threshold</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">static =</span> stepMean <span class="sc">&lt;</span>  <span class="fl">1.5</span>)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="co"># give segments an ID</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>rle_id <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rle</span>(vec)<span class="sc">$</span>lengths</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">seq_along</span>(x), <span class="at">times =</span> x))</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_id =</span> <span class="fu">rle_id</span>(static))<span class="sc">|&gt;</span> </span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="co"># extract single trajectories</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>traj1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_1"</span>)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>traj2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_2"</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>traj3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_3"</span>)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>traj4 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_4"</span>)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>traj5 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_5"</span>)</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>traj6 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_6"</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>traj7 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_7"</span>)</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>traj8 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_8"</span>)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>traj9 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_9"</span>)</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>traj10 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_10"</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>traj11 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_11"</span>)</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>traj12 <span class="ot">&lt;-</span> <span class="fu">filter</span>(training_activities_attributed_sf, ID <span class="sc">==</span> <span class="st">"test_12"</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by true activity</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>summary_training <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span> </span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize per trajectory</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>stops_traj1 <span class="ot">&lt;-</span> traj1 <span class="sc">|&gt;</span> </span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>stops_traj2 <span class="ot">&lt;-</span> traj2 <span class="sc">|&gt;</span> </span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>stops_traj3 <span class="ot">&lt;-</span> traj3 <span class="sc">|&gt;</span> </span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>stops_traj4 <span class="ot">&lt;-</span> traj4 <span class="sc">|&gt;</span> </span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>stops_traj5 <span class="ot">&lt;-</span> traj5 <span class="sc">|&gt;</span> </span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>stops_traj6 <span class="ot">&lt;-</span> traj6 <span class="sc">|&gt;</span> </span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>stops_traj7 <span class="ot">&lt;-</span> traj7 <span class="sc">|&gt;</span> </span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>stops_traj8 <span class="ot">&lt;-</span> traj8 <span class="sc">|&gt;</span> </span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>stops_traj9 <span class="ot">&lt;-</span> traj9 <span class="sc">|&gt;</span> </span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>stops_traj10 <span class="ot">&lt;-</span> traj10 <span class="sc">|&gt;</span> </span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>stops_traj11 <span class="ot">&lt;-</span> traj11 <span class="sc">|&gt;</span> </span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>stops_traj12 <span class="ot">&lt;-</span> traj12 <span class="sc">|&gt;</span> </span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a><span class="co"># function to calculate acceleration</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>acceleration <span class="ot">&lt;-</span> <span class="cf">function</span>(s1, s2, t){</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>((s2<span class="sc">-</span>s1)<span class="sc">/</span>(t))</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate acceleration </span></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>training_activities_attributed_sf <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">acceleration =</span> </span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>    <span class="fu">acceleration</span>(<span class="fu">lag</span>(speedMean), speedMean, timelag_sec))</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize attributes per attribute factor</span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>summary_training <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span> </span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Attribute_factor) <span class="sc">|&gt;</span> </span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">stops =</span> <span class="fu">sum</span>(static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>            <span class="at">not_stops =</span> <span class="fu">sum</span>(<span class="sc">!</span>static, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>            <span class="at">stop_ratio =</span> not_stops<span class="sc">/</span>stops,</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_acceleration =</span> <span class="fu">mean</span>(acceleration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_lenght =</span> <span class="fu">length</span>(segment_id)</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a><span class="co"># create new id to group by for classification</span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>training_activities_for_classification <span class="ot">&lt;-</span> training_activities_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combi_ID =</span> <span class="fu">paste</span>(ID, segment_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize with new id</span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>training_classification <span class="ot">&lt;-</span> training_activities_for_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(combi_ID) <span class="sc">|&gt;</span> </span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_acceleration =</span> <span class="fu">mean</span>(acceleration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>            <span class="at">lenght =</span> <span class="fu">length</span>(segment_id)</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a><span class="co"># apply thresholds for attributes</span></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>training_classification <span class="ot">&lt;-</span> training_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">travel =</span> <span class="fu">if_else</span>(mean_speed <span class="sc">&gt;</span> <span class="fl">1.7</span> <span class="sc">&amp;</span> mean_speed <span class="sc">&lt;</span> <span class="dv">4</span></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="fl">1.7</span> <span class="sc">&amp;</span> mean_step <span class="sc">&lt;</span> <span class="dv">4</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&amp;</span> mean_acceleration <span class="sc">&lt;</span> <span class="fl">0.003</span>,  <span class="dv">1</span> ,  <span class="dv">0</span> ),</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>         <span class="at">recreation =</span> <span class="fu">if_else</span>(travel <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> ) </span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_speed <span class="sc">&gt;</span> <span class="fl">1.1</span>  <span class="sc">&amp;</span> mean_speed <span class="sc">&lt;</span> <span class="fl">1.7</span></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> mean_step <span class="sc">&lt;</span> <span class="fl">1.7</span></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_acceleration <span class="sc">&lt;</span> <span class="fl">0.003</span>,  <span class="dv">1</span> ,  <span class="dv">0</span> ),</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>         <span class="at">shopping =</span> <span class="fu">if_else</span>(travel <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> ) </span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> recreation <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> )</span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_speed <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">|</span>  mean_speed <span class="sc">&lt;</span> <span class="fl">1.1</span></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">|</span> mean_step <span class="sc">&lt;</span> <span class="fl">1.2</span></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_acceleration <span class="sc">&gt;</span> <span class="fl">0.01</span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>                              ,  <span class="dv">1</span> ,  <span class="dv">0</span> ))</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a><span class="co"># create new attribute with activity as character based on applied thresholds</span></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>training_classification <span class="ot">&lt;-</span> training_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">if_else</span>(shopping <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"shopping"</span>, </span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">if_else</span>(recreation <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"recreation"</span>, <span class="st">"travel"</span>),<span class="st">"NA"</span>))</span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a><span class="co"># remove points where classification was not possible</span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>training_classification <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(training_classification)</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a><span class="co"># define activity as factor</span></span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>training_classification <span class="ot">&lt;-</span> training_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_factor =</span> <span class="fu">as.factor</span>(activity)) </span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a><span class="co"># join classified table with sf object</span></span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>training_activities_classified <span class="ot">&lt;-</span> <span class="fu">st_join</span>(training_activities_for_classification, training_classification, <span class="at">left =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate confusion matrix to test classification</span></span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>confus_training <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> training_activities_classified, <span class="at">truth =</span> Attribute_factor, <span class="at">estimate =</span> activity_factor)</span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Export csv for other approaches</span></span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(training_activities_classified, "test_activities_with_attributes_new.csv")</span></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a><span class="co"># get statistics for confusion matrix </span></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(training_activities_classified<span class="sc">$</span>Attribute_factor, training_activities_classified<span class="sc">$</span>activity_factor)</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a><span class="co"># attribute-based classification Saskias data ####</span></span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a><span class="co"># import csv with attributes and convert to sf</span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"activities_saskia_attributiert.csv"</span>, <span class="st">","</span>)</span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> <span class="fu">df_to_sf</span>(activities_saskia_attributed)</span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a><span class="co"># change crs of sf</span></span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(activities_saskia_attributed_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a><span class="co"># set attributes</span></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">DateTime =</span> <span class="fu">as.POSIXct</span>(ts_POSIXct),</span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">Attribute_factor =</span> <span class="fu">as.factor</span>(Attribut)</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate time lag</span></span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">timelag_sec =</span> <span class="fu">difftime_secs</span>(<span class="fu">lead</span>(DateTime,), DateTime)</span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance between locations</span></span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">steplenght =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry), geometry)</span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Check plausibility of calculated parameters</span></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_saskia_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_saskia_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_saskia_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_saskia_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(activities_saskia_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(activities_saskia_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a><span class="co"># based on this check, remove all timelag &gt; 5 and steplenght &gt; 5</span></span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>outliers_timelag <span class="ot">&lt;-</span> <span class="fu">filter</span>(activities_saskia_attributed_sf, timelag_sec <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf[<span class="fu">which</span>(activities_saskia_attributed_sf<span class="sc">$</span>timelag_sec <span class="sc">&lt;=</span> <span class="dv">5</span>),]</span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>outliers_steplenght <span class="ot">&lt;-</span> <span class="fu">filter</span>(activities_saskia_attributed_sf, steplenght <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf[<span class="fu">which</span>(activities_saskia_attributed_sf<span class="sc">$</span>steplenght <span class="sc">&lt;=</span> <span class="dv">5</span>),]</span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a><span class="co"># plot again to make sure it's better</span></span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_saskia_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_saskia_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_saskia_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_saskia_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a><span class="co"># Segmentation</span></span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify a temporal window for mean step</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">nMinus2 =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry, <span class="dv">2</span>), geometry),  </span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>    <span class="at">nMinus1 =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry, <span class="dv">1</span>), geometry),  </span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPlus1  =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lead</span>(geometry, <span class="dv">1</span>)), </span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPlus2  =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lead</span>(geometry, <span class="dv">2</span>))  </span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean step</span></span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> <span class="fu">mean</span>(<span class="fu">c</span>(nMinus2, nMinus1, nPlus1, nPlus2))</span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean speed</span></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">speedMean =</span> stepMean<span class="sc">/</span>timelag_sec</span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a><span class="co"># apply threshold (same as for test data)</span></span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">static =</span> stepMean <span class="sc">&lt;</span>  <span class="fl">1.5</span>)</span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a><span class="co"># give segments an ID</span></span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_id =</span> <span class="fu">rle_id</span>(static)) <span class="sc">|&gt;</span> </span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate acceleration</span></span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>activities_saskia_attributed_sf <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">acceleration =</span> </span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>           <span class="fu">acceleration</span>(<span class="fu">lag</span>(speedMean), speedMean, timelag_sec))</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a><span class="co"># create new id for classification</span></span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>activities_saskia_for_classification <span class="ot">&lt;-</span> activities_saskia_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combi_ID =</span> <span class="fu">paste</span>(ID, segment_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a><span class="co"># group by new id and summarize attributes</span></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>saskia_classification <span class="ot">&lt;-</span> activities_saskia_for_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(combi_ID) <span class="sc">|&gt;</span> </span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_acceleration =</span> <span class="fu">mean</span>(acceleration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>            <span class="at">lenght =</span> <span class="fu">length</span>(segment_id)</span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a><span class="co"># apply thresholds defined for test data</span></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>saskia_classification <span class="ot">&lt;-</span> saskia_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">travel =</span> <span class="fu">if_else</span>(mean_speed <span class="sc">&gt;</span> <span class="fl">1.7</span> <span class="sc">&amp;</span> mean_speed <span class="sc">&lt;</span> <span class="dv">4</span></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="fl">1.7</span> <span class="sc">&amp;</span> mean_step <span class="sc">&lt;</span> <span class="dv">4</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&amp;</span> mean_acceleration <span class="sc">&lt;</span> <span class="fl">0.003</span>,  <span class="dv">1</span> ,  <span class="dv">0</span> ),</span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>         <span class="at">recreation =</span> <span class="fu">if_else</span>(travel <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> ) </span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_speed <span class="sc">&gt;</span> <span class="fl">1.1</span>  <span class="sc">&amp;</span> mean_speed <span class="sc">&lt;</span> <span class="fl">1.7</span></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> mean_step <span class="sc">&lt;</span> <span class="fl">1.7</span></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_acceleration <span class="sc">&lt;</span> <span class="fl">0.003</span>,  <span class="dv">1</span> ,  <span class="dv">0</span> ),</span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>         <span class="at">shopping =</span> <span class="fu">if_else</span>(travel <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> ) </span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> recreation <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> )</span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_speed <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">|</span>  mean_speed <span class="sc">&lt;</span> <span class="fl">1.1</span></span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">|</span> mean_step <span class="sc">&lt;</span> <span class="fl">1.2</span></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_acceleration <span class="sc">&gt;</span> <span class="fl">0.01</span></span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>                            ,  <span class="dv">1</span> ,  <span class="dv">0</span> ))</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a><span class="co"># create attribute with activity as text</span></span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>saskia_classification <span class="ot">&lt;-</span> saskia_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">if_else</span>(shopping <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"shopping"</span>, </span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">if_else</span>(recreation <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"recreation"</span>, <span class="st">"travel"</span>),<span class="st">"NA"</span>))</span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a><span class="co"># remove points that could not be classified</span></span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>saskia_classification <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(saskia_classification)</span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a><span class="co"># set classified activity as factor</span></span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>saskia_classification <span class="ot">&lt;-</span> saskia_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_factor =</span> <span class="fu">as.factor</span>(activity)) </span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a><span class="co"># join classified table with sf object</span></span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a>saskia_activities_classified <span class="ot">&lt;-</span> <span class="fu">st_join</span>(activities_saskia_for_classification, saskia_classification, <span class="at">left =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Export csv for other approaches</span></span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(saskia_activities_classified, "activities_saskia_with_attributes_classified_new.csv")</span></span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a><span class="co"># generate confusion matrix for data</span></span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>confus_saskia <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> saskia_activities_classified, <span class="at">truth =</span> Attribute_factor, <span class="at">estimate =</span> activity_factor)</span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a><span class="co"># get statistics of confusion matrix</span></span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(saskia_activities_classified<span class="sc">$</span>Attribute_factor, saskia_activities_classified<span class="sc">$</span>activity_factor)</span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a><span class="co"># attribute-based classification Sarahs data ####</span></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a><span class="co"># import csv with attributes and convert to sf</span></span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"activities_sarah_attributiert.csv"</span>, <span class="st">","</span>)</span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> <span class="fu">df_to_sf</span>(activities_sarah_attributed)</span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a><span class="co"># change crs of sf</span></span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(activities_sarah_attributed_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a><span class="co"># set attributes</span></span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">DateTime =</span> <span class="fu">as.POSIXct</span>(ts_POSIXct),</span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">Attribute_factor =</span> <span class="fu">as.factor</span>(Attribut)</span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate time lag</span></span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>    <span class="at">timelag_sec =</span> <span class="fu">difftime_secs</span>(<span class="fu">lead</span>(DateTime,), DateTime)</span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate distance between locations</span></span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">steplenght =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry), geometry)</span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Check plausibility of calculated parameters</span></span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_sarah_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_sarah_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_sarah_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_sarah_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(activities_sarah_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(activities_sarah_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a><span class="co"># based on this check, all timelag &gt; 5 and steplenght &gt; 5</span></span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>outliers_timelag <span class="ot">&lt;-</span> <span class="fu">filter</span>(activities_sarah_attributed_sf, timelag_sec <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf[<span class="fu">which</span>(activities_sarah_attributed_sf<span class="sc">$</span>timelag_sec <span class="sc">&lt;=</span> <span class="dv">5</span>),]</span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>outliers_steplenght <span class="ot">&lt;-</span> <span class="fu">filter</span>(activities_sarah_attributed_sf, steplenght <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf[<span class="fu">which</span>(activities_sarah_attributed_sf<span class="sc">$</span>steplenght <span class="sc">&lt;=</span> <span class="dv">5</span>),]</span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a><span class="co"># plot again to make sure it's better</span></span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_sarah_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(activities_sarah_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_sarah_attributed_sf<span class="sc">$</span>timelag_sec)</span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(activities_sarah_attributed_sf<span class="sc">$</span>steplenght)</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a><span class="co"># Segmentation</span></span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify a temporal window for mean step</span></span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">nMinus2 =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry, <span class="dv">2</span>), geometry),  </span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">nMinus1 =</span> <span class="fu">distance_by_element</span>(<span class="fu">lag</span>(geometry, <span class="dv">1</span>), geometry),  </span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPlus1  =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lead</span>(geometry, <span class="dv">1</span>)), </span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPlus2  =</span> <span class="fu">distance_by_element</span>(geometry, <span class="fu">lead</span>(geometry, <span class="dv">2</span>))  </span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean step</span></span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">stepMean =</span> <span class="fu">mean</span>(<span class="fu">c</span>(nMinus2, nMinus1, nPlus1, nPlus2))</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean speed</span></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">speedMean =</span> stepMean<span class="sc">/</span>timelag_sec</span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a><span class="co"># apply threshold defined in test data</span></span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">static =</span> stepMean <span class="sc">&lt;</span>  <span class="fl">1.5</span>)</span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a><span class="co"># give segments an ID</span></span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_id =</span> <span class="fu">rle_id</span>(static)) <span class="sc">|&gt;</span> </span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate acceleration ####</span></span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>activities_sarah_attributed_sf <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">acceleration =</span> </span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>           <span class="fu">acceleration</span>(<span class="fu">lag</span>(speedMean), speedMean, timelag_sec))</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a><span class="co"># create new id to group for classification</span></span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>activities_sarah_for_classification <span class="ot">&lt;-</span> activities_sarah_attributed_sf <span class="sc">|&gt;</span> </span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combi_ID =</span> <span class="fu">paste</span>(ID, segment_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a><span class="co"># group by newly set id</span></span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a>sarah_classification <span class="ot">&lt;-</span> activities_sarah_for_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(combi_ID) <span class="sc">|&gt;</span> </span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_acceleration =</span> <span class="fu">mean</span>(acceleration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_speed =</span> <span class="fu">mean</span>(speedMean, <span class="at">na.rm =</span><span class="cn">TRUE</span>),</span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_step =</span> <span class="fu">mean</span>(stepMean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>            <span class="at">lenght =</span> <span class="fu">length</span>(segment_id)</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a><span class="co"># apply defined thresholds</span></span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>sarah_classification <span class="ot">&lt;-</span> sarah_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">travel =</span> <span class="fu">if_else</span>(mean_speed <span class="sc">&gt;</span> <span class="fl">1.7</span> <span class="sc">&amp;</span> mean_speed <span class="sc">&lt;</span> <span class="dv">4</span></span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="fl">1.7</span> <span class="sc">&amp;</span> mean_step <span class="sc">&lt;</span> <span class="dv">4</span></span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>                          <span class="sc">&amp;</span> mean_acceleration <span class="sc">&lt;</span> <span class="fl">0.003</span>,  <span class="dv">1</span> ,  <span class="dv">0</span> ),</span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>         <span class="at">recreation =</span> <span class="fu">if_else</span>(travel <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> ) </span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_speed <span class="sc">&gt;</span> <span class="fl">1.1</span>  <span class="sc">&amp;</span> mean_speed <span class="sc">&lt;</span> <span class="fl">1.7</span></span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> mean_step <span class="sc">&lt;</span> <span class="fl">1.7</span></span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">&amp;</span> mean_acceleration <span class="sc">&lt;</span> <span class="fl">0.003</span>,  <span class="dv">1</span> ,  <span class="dv">0</span> ),</span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a>         <span class="at">shopping =</span> <span class="fu">if_else</span>(travel <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> ) </span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> recreation <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">0</span> )</span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_speed <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">|</span>  mean_speed <span class="sc">&lt;</span> <span class="fl">1.1</span></span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_step <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">|</span> mean_step <span class="sc">&lt;</span> <span class="fl">1.2</span></span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">&amp;</span> mean_acceleration <span class="sc">&gt;</span> <span class="fl">0.01</span></span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>                            ,  <span class="dv">1</span> ,  <span class="dv">0</span> ))</span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a><span class="co"># get attribute activity as text</span></span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>sarah_classification <span class="ot">&lt;-</span> sarah_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">if_else</span>(shopping <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"shopping"</span>, </span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">if_else</span>(recreation <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"recreation"</span>, <span class="st">"travel"</span>),<span class="st">"NA"</span>))</span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a><span class="co"># remove points that could not be classified</span></span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a>sarah_classification <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(sarah_classification)</span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a><span class="co"># set classified activity as factor</span></span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a>sarah_classification <span class="ot">&lt;-</span> sarah_classification <span class="sc">|&gt;</span> </span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_factor =</span> <span class="fu">as.factor</span>(activity)) </span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a><span class="co"># join classification table with sf object</span></span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>sarah_activities_classified <span class="ot">&lt;-</span> <span class="fu">st_join</span>(activities_sarah_for_classification, sarah_classification, <span class="at">left =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a><span class="co"># Export csv for other approaches</span></span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(sarah_activities_classified, "activities_sarah_with_attributes_classified_new.csv")</span></span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a><span class="co"># calcualte confusion matrix</span></span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>confus_sarah <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> sarah_activities_classified, <span class="at">truth =</span> Attribute_factor, <span class="at">estimate =</span> activity_factor)</span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a><span class="co"># get statitics for confusion matrix</span></span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(sarah_activities_classified<span class="sc">$</span>Attribute_factor, sarah_activities_classified<span class="sc">$</span>activity_factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>CAMA based classification</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Re-read clipped data, remove not- needed columns and filter if required ----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>gebaeude_clip<span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/gebaeude_selection.gpkg"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>gebaeude_clip <span class="ot">&lt;-</span> gebaeude_clip[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">40</span>)]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>bodenbedeckung_clip<span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/bodenbedeckung_selection.gpkg"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>bodenbedeckung_clip<span class="ot">&lt;-</span>bodenbedeckung_clip[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">37</span>)]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>nutzungsareal_clip<span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/nutzungsareal_selection.gpkg"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>nutzungsareal_clip<span class="ot">&lt;-</span>nutzungsareal_clip[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">11</span>,<span class="dv">39</span>)]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>strassen_clip<span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/strassen_selection.gpkg"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#reduce roads to roads associated with recreational activities</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>strassen_recreational <span class="ot">&lt;-</span>strassen_clip <span class="sc">|&gt;</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(objektart <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ausfahrt"</span>,<span class="st">"Einfahrt"</span>,<span class="st">"Zufahrt"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"3m Strasse"</span>,<span class="st">"1m Weg"</span> ,<span class="st">"2m Weg"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"1m Wegfragment"</span>,<span class="st">"2m Wegfragment"</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(strassen_clip)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>strassen_recreational<span class="ot">&lt;-</span>strassen_recreational[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">51</span>)]</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>oev_clip<span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/oev_selection.gpkg"</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>oev_clip<span class="ot">&lt;-</span>oev_clip[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">40</span>)]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="do">##Create Buffers ----</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>bodenbuf <span class="ot">&lt;-</span><span class="fu">st_buffer</span>(bodenbedeckung_clip, <span class="at">dist=</span><span class="dv">10</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(bodenbedeckung_clip)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>nutzungsbuf <span class="ot">&lt;-</span><span class="fu">st_buffer</span>(nutzungsareal_clip, <span class="at">dist=</span><span class="dv">10</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(nutzungsareal_clip)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>strassenbuf <span class="ot">&lt;-</span><span class="fu">st_buffer</span>(strassen_recreational, <span class="at">dist=</span><span class="dv">10</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(strassen_recreational)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>oevbuf <span class="ot">&lt;-</span><span class="fu">st_buffer</span>(oev_clip, <span class="at">dist=</span><span class="dv">50</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(oev_clip)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="do">##Workflow with Saskia's training- data ----</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="do">###Read activity data ----</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf <span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/test_activities_attributiert.gpkg"</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sas_tra_activities_classified_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="do">###Join with objects -----</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tra_activities_classified_sf, bodenbuf, <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_boden=</span> objektart)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tra_activities_classified_sf, nutzungsbuf ,  <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_nutzung=</span> objektart)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tra_activities_classified_sf, strassenbuf, <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_strassen=</span> objektart)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tra_activities_classified_sf, oevbuf , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_pub_trans=</span> objektart)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tra_activities_classified_sf, gebaeude_clip ,<span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_geb=</span> objektart)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf <span class="ot">=</span> <span class="fu">subset</span>(sas_tra_activities_classified_sf,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(uuid.x...<span class="dv">9</span>,uuid.y...<span class="dv">11</span>, uuid.x...<span class="dv">13</span>, uuid.y...<span class="dv">15</span>,uuid ))</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="do">###Create presence/absence information for objects ----</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>recreation_b <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tra_activities_classified_sf<span class="sc">$</span>obj_boden <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>recreation_n <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tra_activities_classified_sf<span class="sc">$</span>obj_nutzung <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>recreation_s <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tra_activities_classified_sf<span class="sc">$</span>obj_strassen <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recreation =</span> <span class="fu">case_when</span>(recreation_b <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>, </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>                                recreation_n <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>, </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>                                recreation_s <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>))</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>recreation[<span class="fu">is.na</span>(sas_tra_activities_classified_sf<span class="sc">$</span>recreation)] <span class="ot">&lt;-</span> <span class="st">"FALSE"</span> </span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>recreation<span class="ot">&lt;-</span><span class="fu">as.logical</span>(sas_tra_activities_classified_sf<span class="sc">$</span>recreation)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>pub_trans <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tra_activities_classified_sf<span class="sc">$</span>obj_pub_trans<span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>                                       , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="sc">$</span>gebaeude <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tra_activities_classified_sf<span class="sc">$</span>obj_geb) <span class="sc">==</span> <span class="cn">TRUE</span> , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)    </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>sas_tra_activities_classified_sf<span class="ot">&lt;-</span>sas_tra_activities_classified_sf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>)]</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="do">### Classification ----</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>sas_tra_classification <span class="ot">&lt;-</span> sas_tra_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">if_else</span>(gebaeude <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"shopping"</span>, </span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">if_else</span>(pub_trans <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"travel"</span>,</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">if_else</span>(recreation <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"recreation"</span>, <span class="st">"travel"</span>),<span class="cn">NA</span>)))</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>sas_tra_classification <span class="ot">&lt;-</span> sas_tra_classification <span class="sc">|&gt;</span> </span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_factor =</span> <span class="fu">as.factor</span>(activity)) </span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>sas_tra_classification <span class="ot">&lt;-</span> sas_tra_classification <span class="sc">|&gt;</span> </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Attribute_factor =</span> <span class="fu">as.factor</span>(Attribut))<span class="co">#change character to factor for confusion matrix</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(sas_tra_test_classification, dsn="CAMA_data/ cama_classification_results_saskia_training.gpkg")#export classification results</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="do">###Confusion matrix ----</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>sas_tra_classification <span class="ot">&lt;-</span><span class="fu">na.omit</span>(sas_tra_classification)</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>confus_sas_tra_cama <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> sas_tra_classification, <span class="at">truth =</span> Attribute_factor, </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>                  <span class="at">estimate =</span> activity_factor)</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="do">###Compute model accuracy ----</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(sas_tra_classification<span class="sc">$</span>Attribute_factor, sas_tra_classification<span class="sc">$</span>activity_factor)</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="do">##Workflow with Saskia's test- data ----</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="do">###read activity data  ----</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"CAMA_data/activities_saskia_attributiert.csv"</span>)</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>ts_POSIXct <span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(sas_tes_activities_classified_sf<span class="sc">$</span>ts_POSIXct)</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf <span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(sas_tes_activities_classified_sf, </span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>                          <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span> , <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sas_tes_activities_classified_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="do">###Join with objects -----</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tes_activities_classified_sf, bodenbuf,<span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_boden=</span> objektart)</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tes_activities_classified_sf, nutzungsbuf , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_nutzung=</span> objektart)</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tes_activities_classified_sf, strassenbuf , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_strassen=</span> objektart)</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tes_activities_classified_sf, oevbuf , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_pub_trans=</span> objektart)</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sas_tes_activities_classified_sf, gebaeude_clip , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_geb=</span> objektart)</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf <span class="ot">=</span> <span class="fu">subset</span>(sas_tes_activities_classified_sf,</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>                          <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(fid,uuid.x...<span class="dv">10</span>,uuid.y...<span class="dv">12</span>, uuid.x...<span class="dv">14</span>,</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>                                      uuid.y...<span class="dv">16</span>,uuid))</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="do">###Create presence/absence information for objects ----</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>recreation_b <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tes_activities_classified_sf<span class="sc">$</span>obj_boden <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>recreation_n <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tes_activities_classified_sf<span class="sc">$</span>obj_nutzung <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>recreation_s <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tes_activities_classified_sf<span class="sc">$</span>obj_strassen <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recreation =</span> <span class="fu">case_when</span>(recreation_b <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>                                recreation_n <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>, </span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>                                recreation_s <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>))</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>recreation[<span class="fu">is.na</span>(sas_tes_activities_classified_sf<span class="sc">$</span>recreation)] <span class="ot">&lt;-</span> <span class="st">"FALSE"</span> </span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>recreation<span class="ot">&lt;-</span><span class="fu">as.logical</span>(sas_tes_activities_classified_sf<span class="sc">$</span>recreation)</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>pub_trans <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tes_activities_classified_sf<span class="sc">$</span>obj_pub_trans<span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="sc">$</span>gebaeude <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sas_tes_activities_classified_sf<span class="sc">$</span>obj_geb) <span class="sc">==</span> <span class="cn">TRUE</span> , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)    </span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>sas_tes_activities_classified_sf<span class="ot">&lt;-</span>sas_tes_activities_classified_sf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>)]</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a><span class="do">###Classification ----</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>sas_test_classification <span class="ot">&lt;-</span> sas_tes_activities_classified_sf<span class="sc">|&gt;</span> </span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">if_else</span>(gebaeude <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"shopping"</span>, </span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">if_else</span>(pub_trans <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"travel"</span>,</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">if_else</span>(recreation <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"recreation"</span>, <span class="st">"travel"</span>),<span class="cn">NA</span>)))</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>sas_test_classification <span class="ot">&lt;-</span> sas_test_classification <span class="sc">|&gt;</span> </span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_factor =</span> <span class="fu">as.factor</span>(activity)) </span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>sas_test_classification <span class="ot">&lt;-</span>sas_test_classification <span class="sc">|&gt;</span> </span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Attribute_factor =</span> <span class="fu">as.factor</span>(Attribut))<span class="co">#change character to factor for confusion matrix</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(sas_test_classification, dsn="CAMA_data/ cama__results_saskia_test.gpkg")#export classification results</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a><span class="do">###Confusion matrix ----</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>sas_test_classification<span class="ot">&lt;-</span><span class="fu">na.omit</span>(sas_test_classification)</span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>confus_sas_tes_cama <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> sas_test_classification, <span class="at">truth =</span> Attribute_factor, <span class="at">estimate =</span> activity_factor)</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a><span class="do">###Compute model accuracy ----</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(sas_test_classification<span class="sc">$</span>Attribute_factor, sas_test_classification<span class="sc">$</span>activity_factor)</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a><span class="do">##Workflow with Sarah's test- data ----</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a><span class="do">###Read activity data  ----</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf <span class="ot">&lt;-</span><span class="fu">read_sf</span>(<span class="st">"CAMA_data/activities_sarah_classified.gpkg"</span>)</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sar_tes_activities_classified_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a><span class="do">###Join with objects -----</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sar_tes_activities_classified_sf, bodenbuf,<span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_boden=</span> objektart)</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sar_tes_activities_classified_sf, nutzungsbuf , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_nutzung=</span> objektart)</span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sar_tes_activities_classified_sf, strassenbuf ,<span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_strassen=</span> objektart)</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sar_tes_activities_classified_sf, oevbuf , <span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_pub_trans=</span> objektart)</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span><span class="fu">st_join</span>(sar_tes_activities_classified_sf, gebaeude_clip ,<span class="at">join=</span>st_within,<span class="at">left=</span><span class="cn">TRUE</span>, <span class="at">largest=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">obj_geb=</span> objektart)</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf <span class="ot">=</span> <span class="fu">subset</span>(sar_tes_activities_classified_sf, </span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(uuid.x...<span class="dv">9</span>,uuid.y...<span class="dv">11</span>, uuid.x...<span class="dv">13</span>,uuid.y...<span class="dv">15</span>,uuid ))</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a><span class="do">###Create presence/absence information for objects ----</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>recreation_b <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sar_tes_activities_classified_sf<span class="sc">$</span>obj_boden <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>recreation_n <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sar_tes_activities_classified_sf<span class="sc">$</span>obj_nutzung <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>recreation_s <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sar_tes_activities_classified_sf<span class="sc">$</span>obj_strassen <span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recreation =</span> <span class="fu">case_when</span>(recreation_b <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>, </span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>                                recreation_n <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>, </span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>                                recreation_s <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"TRUE"</span>))</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>recreation[<span class="fu">is.na</span>(sar_tes_activities_classified_sf<span class="sc">$</span>recreation)] <span class="ot">&lt;-</span> <span class="st">"FALSE"</span> </span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>recreation<span class="ot">&lt;-</span><span class="fu">as.logical</span>(sar_tes_activities_classified_sf<span class="sc">$</span>recreation)</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>pub_trans <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sar_tes_activities_classified_sf<span class="sc">$</span>obj_pub_trans<span class="sc">==</span> <span class="cn">TRUE</span>) , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="sc">$</span>gebaeude <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(sar_tes_activities_classified_sf<span class="sc">$</span>obj_geb) <span class="sc">==</span> <span class="cn">TRUE</span> , <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)    </span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>sar_tes_activities_classified_sf<span class="ot">&lt;-</span>sar_tes_activities_classified_sf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">17</span><span class="sc">:</span><span class="dv">19</span>)]</span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a><span class="do">###Classification ----</span></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>sar_test_classification <span class="ot">&lt;-</span> sar_tes_activities_classified_sf <span class="sc">|&gt;</span> </span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity =</span> <span class="fu">if_else</span>(gebaeude <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"shopping"</span>, </span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">if_else</span>(pub_trans <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"travel"</span>,</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">if_else</span>(recreation <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="st">"recreation"</span>, <span class="st">"travel"</span>),<span class="cn">NA</span>)))</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>sar_test_classification <span class="ot">&lt;-</span> sar_test_classification <span class="sc">|&gt;</span> </span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_factor =</span> <span class="fu">as.factor</span>(activity)) </span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>sar_test_classification <span class="ot">&lt;-</span>sar_test_classification <span class="sc">|&gt;</span> </span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Attribute_factor =</span> <span class="fu">as.factor</span>(Attribut))<span class="co">#change character to factor for confusion matrix</span></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a><span class="co">#st_write(sar_test_classification, dsn="CAMA_data/ cama_classification_results_sarah.gpkg")#export sar_test_classification results</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a><span class="do">###Confusion matrix ----</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>sar_test_classification<span class="ot">&lt;-</span><span class="fu">na.omit</span>(sar_test_classification)</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>confus_sar_tes_cama <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> sar_test_classification, <span class="at">truth =</span> Attribute_factor, <span class="at">estimate =</span> activity_factor)</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a><span class="do">###Compute model accuracy ----</span></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(sar_test_classification<span class="sc">$</span>Attribute_factor, sar_test_classification<span class="sc">$</span>activity_factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>CART based classification</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Workflow based on Saskia's training- data ----</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">###Import movement attributes and results of CAMA analysis and transform them into spatial objects ----</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>activities_attributes <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"test_activities_with_attributes_new.csv"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>activities_attributes<span class="sc">$</span>ts_POSIXct <span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(activities_attributes<span class="sc">$</span>ts_POSIXct)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>activities_attributes_sf <span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(activities_attributes,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span> ,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>activities_attributes_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(activities_attributes_sf, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>activities_attributes_sf  <span class="ot">&lt;-</span>activities_attributes_sf [,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>,<span class="dv">30</span><span class="sc">:</span><span class="dv">32</span>)]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#remove non-required columns</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="do">###Join data from CAMA and walking- attributes -----</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>activities_sas_train<span class="ot">&lt;-</span><span class="fu">st_join</span>(activities_attributes_sf,sas_tra_classification,  <span class="at">largest=</span><span class="cn">TRUE</span>)<span class="co">#largest = TRUE to remove duplicates</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>activities_sas_train<span class="sc">$</span>Attribute_factor.x <span class="ot">&lt;-</span><span class="fu">as.factor</span>(activities_sas_train<span class="sc">$</span>Attribute_factor.x)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="do">###Create tree ----</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6832</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>model_sas_train <span class="ot">&lt;-</span><span class="fu">rpart</span>(Attribute_factor.x<span class="sc">~</span> speedMean<span class="sc">+</span>stepMean<span class="sc">+</span>acceleration<span class="sc">+</span> recreation <span class="sc">+</span> pub_trans <span class="sc">+</span> gebaeude, <span class="at">data=</span>activities_sas_train, <span class="at">method=</span> <span class="st">"class"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="do">###Make prediction on original data for confusion matrix----</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>pred_model_sas_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model_sas_train, <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>activities_sas_train<span class="sc">$</span>pred<span class="ot">&lt;-</span>pred_model_sas_train</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="do">### Confusion matrix for training- data ---</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>confus_cart_train <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span>activities_sas_train, <span class="at">truth =</span> Attribute_factor.x,<span class="at">estimate =</span> pred)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="do">### Compute model accuracy rate on Sakia's training data----</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(activities_sas_train<span class="sc">$</span>Attribute_factor.x, activities_sas_train<span class="sc">$</span>pred)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="do">##Make predictions on the test data from Saskia ----</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="do">###Import movement attributes and results of CAMA analysis and transform them into spatial objects ----</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>activities_attributes_sas_test <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"activities_saskia_with_attributes_classified_new.csv"</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>activities_attributes_sas_test<span class="sc">$</span>ts_POSIXct <span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(activities_attributes_sas_test<span class="sc">$</span>ts_POSIXct)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>activities_attributes_sf_sas_test <span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(activities_attributes_sas_test,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span> ,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>activities_attributes_sf_sas_test  <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(activities_attributes_sf_sas_test , <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>activities_attributes_sf_sas_test <span class="ot">&lt;-</span>activities_attributes_sf_sas_test[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">27</span>,<span class="dv">31</span><span class="sc">:</span><span class="dv">33</span>)]<span class="do">##remove non-required columns</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="do">###Join data from CAMA and walking- attributes -----</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>activities_sas_test<span class="ot">&lt;-</span><span class="fu">st_join</span>(activities_attributes_sf_sas_test ,sas_test_classification, <span class="at">largest=</span><span class="cn">TRUE</span>)<span class="co">#largest = TRUE to remove duplicates</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>activities_sas_test<span class="sc">$</span>Attribute_factor.x <span class="ot">&lt;-</span><span class="fu">as.factor</span>(activities_sas_test<span class="sc">$</span>Attribute_factor.x)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>pred_model_sas_test<span class="ot">&lt;-</span> model_sas_train <span class="sc">|&gt;</span>  </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(activities_sas_test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>activities_sas_test<span class="sc">$</span>pred <span class="ot">&lt;-</span>pred_model_sas_test</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="do">### Confusion matrix for Sakia's test- data  ---</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>confus_cart_test_sas <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> activities_sas_test,</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                           <span class="at">truth =</span> Attribute_factor.x, <span class="at">estimate =</span> pred)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="do">### Compute model accuracy rate on Sakia's test data----</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(activities_sas_test<span class="sc">$</span>Attribute_factor.x, activities_sas_test<span class="sc">$</span>pred)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="do">##Make predictions on the test data from Sarah ----</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="do">###Import movement attributes and results of CAMA analysis and transform them into spatial objects</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>activities_attributes_sarah <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"activities_sarah_with_attributes_classified_new.csv"</span>)</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>activities_attributes_sarah<span class="sc">$</span>ts_POSIXct <span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(activities_attributes_sarah<span class="sc">$</span>ts_POSIXct)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>activities_attributes_sarah_sf <span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(activities_attributes_sarah,</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>,<span class="st">"lat"</span>),</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">crs =</span> <span class="dv">4326</span> , <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>activities_attributes_sarah_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(activities_attributes_sarah_sf,</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>activities_attributes_sarah_sf <span class="ot">&lt;-</span>activities_attributes_sarah_sf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">27</span>,<span class="dv">31</span><span class="sc">:</span><span class="dv">33</span>)]<span class="do">##remove non-required columns</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="do">###Join data from CAMA and walking- attributes -----</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>activities_sar_test<span class="ot">&lt;-</span><span class="fu">st_join</span>(activities_attributes_sarah_sf,sar_test_classification)<span class="co">#no largest required as the activity-data does not create duplicates</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>activities_sar_test<span class="sc">$</span>Attribute_factor.x <span class="ot">&lt;-</span><span class="fu">as.factor</span>(activities_sar_test<span class="sc">$</span>Attribute_factor.x)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>pred_model_sar_test<span class="ot">&lt;-</span> model_sas_train <span class="sc">|&gt;</span>  </span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(activities_sar_test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>activities_sar_test<span class="sc">$</span>pred <span class="ot">&lt;-</span>pred_model_sar_test</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a><span class="do">### Confusion matrix for Sarah's test- data  ---</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>confus_cart_sar_test <span class="ot">&lt;-</span><span class="fu">conf_mat</span>(<span class="at">data =</span> activities_sar_test, </span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>                           <span class="at">truth =</span> Attribute_factor.x, <span class="at">estimate =</span> pred)</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="do">### Compute model accuracy rate on Sarah's test data----</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(activities_sar_test<span class="sc">$</span>Attribute_factor.x, activities_sar_test<span class="sc">$</span>pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Visualisation of workflows</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rankdir = LR, label = '\n\n',labelloc = t</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Overall workflow ----</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">&lt;-</span> <span class="fu">grViz</span>(<span class="st">"digraph{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">graph [layout = dot, rankdir = LR]</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">node [shape = rectangle, style = filled,  fillcolor = white]</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">datatrain[label='training data Saskia', shape = folder, fillcolor = beige]</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">datatestsas[label='test data Saskia', shape = folder, fillcolor = beige]</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">datatestsar[label='test data Sarah', shape = folder, fillcolor = beige]</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">classify[label='classify manually </span><span class="sc">\\</span><span class="st">n into actual walking patterns']</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">attribute[label='workflow attribute </span><span class="sc">\\</span><span class="st">n based classification', fillcolor = aliceblue]</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">derattributes[label='derive attributes']</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">threshattributes[label='set thresholds based on  </span><span class="sc">\\</span><span class="st">n summaries of trajectories </span><span class="sc">\\</span><span class="st">n from training data']</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">classifyattributes[label='classify based on thresholds']</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">validate[label='validate with validation workflow']</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">camawork[label='workflow CAMA </span><span class="sc">\\</span><span class="st">n based classification', fillcolor = aliceblue]</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="st">tlm[label='choose swissTLM3D layers, </span><span class="sc">\\</span><span class="st">n which represent certain attributes']</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="st">buf[label='create buffers']</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="st">intersect[label='check for presence in buffers </span><span class="sc">\\</span><span class="st">n position in buffers']</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="st">camaclass[label='classify based on </span><span class="sc">\\</span><span class="st">n  presence in buffers']</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="st">cartwork [label ='workflow CART </span><span class="sc">\\</span><span class="st">n based classification', fillcolor = aliceblue]</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="st">join[label='join data from </span><span class="sc">\\</span><span class="st">n previous workflows </span><span class="sc">\\</span><span class="st">n from the training data']</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">cart [label='create CART']</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="st">{datatrain datatestsas datatestsar} -&gt;classify</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="st">classify -&gt; {attribute camawork}</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="st">attribute -&gt; derattributes</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="st">derattributes -&gt; threshattributes</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="st">threshattributes -&gt; classifyattributes</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="st">classifyattributes -&gt; validate</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="st">camawork -&gt; tlm</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="st">tlm -&gt; buf</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="st">buf -&gt; intersect</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="st">intersect -&gt; camaclass</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="st">camaclass -&gt; validate</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="st">{derattributes intersect} -&gt; cartwork</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="st">cartwork -&gt; join</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="st">join -&gt; cart</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="st">cart -&gt; validate</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>) </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>overall <span class="sc">|&gt;</span> </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">export_svg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">charToRaw</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsvg_png</span>(<span class="st">"overall.png"</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation workflow ----</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>validation_workflow <span class="ot">&lt;-</span> <span class="fu">grViz</span>(<span class="st">"digraph{</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="st">graph [layout = dot]</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="st">node [shape = rectangle, style = filled, rankdir = LR, fillcolor = white]</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="st">valwork[label='validation workflow', fillcolor = aliceblue]</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="st">valtrain[label='apply validation steps </span><span class="sc">\\</span><span class="st">n on results from </span><span class="sc">\\</span><span class="st">n training data']</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="st">applyattr[label='use thresholds </span><span class="sc">\\</span><span class="st">n from attribute based classification </span><span class="sc">\\</span><span class="st">n on test data']</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="st">applycama[label='use classification rules </span><span class="sc">\\</span><span class="st">n from CAMA based classification </span><span class="sc">\\</span><span class="st">n on test data']</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="st">applycart[label='apply CART tree to test data']</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="st">conf[label='create confusion matix']</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="st">acc[label='derive accuracy of classification']</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="st">valwork -&gt; {valtrain applyattr applycama applycart}</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="st">{valtrain applyattr applycama applycart} -&gt; {conf acc}</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>validation_workflow <span class="sc">|&gt;</span> </span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">export_svg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">charToRaw</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsvg_png</span>(<span class="st">"validation.png"</span>)</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="co">#Attribute based ----</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>attribute_based_workflow <span class="ot">&lt;-</span> <span class="fu">grViz</span>(<span class="st">"digraph{</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="st">graph [layout = dot, rankdir = LR]</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="st">node [shape = rectangle, style = filled, fillcolor = white]</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="st">travel[label='mean speed 1.7m/s - 4m/s </span><span class="sc">\\</span><span class="st">n mean step 1.7m - 4m </span><span class="sc">\\</span><span class="st">n mean acceleration &lt; 0.003m^2']</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="st">travelyes[label='Yes']</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="st">traveltra[label='Is travel']</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="st">travelno[label='No']</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="st">recr[label='mean speed 1.1m/s - 1.7m/s </span><span class="sc">\\</span><span class="st">n mean step 1.2m - 1.7m </span><span class="sc">\\</span><span class="st">n mean acceleration &lt;0.003m^2']</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="st">recryes[label='Yes']</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="st">recrtra[label='Is recreation']</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="st">recrno[label='No']</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="st">shop[label='mean speed &gt; 4m/s or &lt; 1.1m/s </span><span class="sc">\\</span><span class="st">n mean step &gt; 4m or &lt; 1.2 </span><span class="sc">\\</span><span class="st">n mean acceleration &gt;0.001m^2']</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="st">shopyes[label='Yes']</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="st">shopyesshop[label='Is shopping']</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="st">shopno[label='No ']</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="st">shoptra[label='Is NA']</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="st">travel-&gt;{travelyes travelno}</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="st">travelyes-&gt;traveltra</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="st">travelno -&gt;recr</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="st">recr -&gt; {recryes recrno}</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="st">recryes -&gt; recrtra</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="st">recrno -&gt; shop</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="st">shop -&gt;{shopyes shopno}</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="st">shopyes -&gt;shopyesshop</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="st">shopno -&gt;shoptra</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>attribute_based_workflow <span class="sc">|&gt;</span> </span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">export_svg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">charToRaw</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsvg_png</span>(<span class="st">"abw.png"</span>)</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a><span class="co">#CAMA based</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>cama_workflow <span class="ot">&lt;-</span> <span class="fu">grViz</span>(<span class="st">"digraph{</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="st">graph [layout = dot, rankdir = LR]</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="st">node [shape = rectangle, style = filled, fillcolor = white]</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="st">build[label='Is it in a building?']</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="st">buildyes[label='Yes']</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a><span class="st">buildshop[label='Is shopping']</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="st">buildno[label='No']</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="st">pubtrans[label='Is it in a 50m radius of a public transport station?']</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="st">pubtranspyes[label='Yes']</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="st">pubtransptra[label='Is travel']</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="st">pubtranspno[label='No']</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="st">recr[label=' Is it in a range of 10m of a recreational area?']</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a><span class="st">recryes[label='Yes']</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a><span class="st">recryesrec[label='Is recreation']</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a><span class="st">recrno[label='No ']</span></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a><span class="st">recrtra[label='Is travel']</span></span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a><span class="st">build-&gt;{buildyes buildno}</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a><span class="st">buildyes-&gt;buildshop</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a><span class="st">buildno -&gt;pubtrans</span></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a><span class="st">pubtrans -&gt; {pubtranspyes pubtranspno}</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a><span class="st">pubtranspyes -&gt; pubtransptra</span></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a><span class="st">pubtranspno -&gt; recr</span></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a><span class="st">recr -&gt;{recryes recrno}</span></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="st">recryes -&gt;recryesrec</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="st">recrno -&gt;recrtra</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>cama_workflow <span class="sc">|&gt;</span> </span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">export_svg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">charToRaw</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsvg_png</span>(<span class="st">"cama.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>The main question this paper attempts to answer is whether it is possible to differentiate between the walking pattern from recreation, travel and shopping. Data is collected with the Strava App. Three approaches are developed, tested and evaluated. The first approach is a classification based on the attributes speed, step length and acceleration. The second approach is a classification based on the surroundings. The third approach is the development of a CART-tree that combines the attributes generated in the first approach and the context information from the second approach. We can conclude that the attribute-based classification is not able to cleanly separate travel and recreation. For shopping, there was no clear pattern to be found, as the GPS signal is most often lost in the building.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The aim of this paper is to test and compare different approaches to detect walking patterns. The different patterns that should be able to be distinguished are walking for recreational purposes, walking for commuting and shopping. The underlying idea is that the pattern of these walking types differs in their attributes and the environment that there are based in. It was already shown that a differentiation between transit and walking based on speed is possible <span class="citation" data-cites="kim_new_2012">(<a href="#ref-kim_new_2012" role="doc-biblioref">Kim et al. 2012</a>)</span>. Also, outdoor walking activities are generally longer, more continuous and faster with the walking duration being the most important attribute for classification <span class="citation" data-cites="baroudi_classification_2024">(<a href="#ref-baroudi_classification_2024" role="doc-biblioref">Baroudi et al. 2024</a>)</span>.<br>
Based on walking data tracked with the Strava app, we want to answer the following research questions:<br>
- How well it possible to derive the type of activity from movement data considering the attributes sinuosity, speed, sinuosity and visited locations?<br>
- Which type of analytical approach performs best in differentiating between the different activities?<br>
- How does the performance of the analytical concepts differ when applied on trajectories recorded by different people?<br>
The three approaches used in this study are classification based on attributes of the trajectory, CAMA-analysis and classification based on CART tree. The approaches are described in detail in the chapter material and methods. The following figure show the workflow for the three classification methods.<br>
<img src="overall.png" class="img-fluid" alt="workflow"></p>
</section>
<section id="material-and-methods" class="level2">
<h2 class="anchored" data-anchor-id="material-and-methods">Material and Methods</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Data was collected with the Strava App from March to June 2024. The training data for the development of the algorithms consists of 12 trajectories recorded by Saskia in March and April 2024. There are 13’636 attributed points. Additional data was collected by Saskia and Sarah in June 2024 to enable testing of the developed algorithms. Additional three trajectories recorded from Saskia in 2023 are used to test the algorithms. The algorithms are tested separately on the data of both. This allows drawing a conclusion whether the algorithms are able to differentiate walking patterns from different people. Saskia’s test data consists of 6 trajectories and a total of 8’559 attributed points. Sarah’s test data consists of 12 trajectories and a total of 17’648 attributed points. The analysis is done using the software R <span class="citation" data-cites="R">(<a href="#ref-R" role="doc-biblioref">R Core Team 2024</a>)</span> and RStudio <span class="citation" data-cites="Rstudio">(<a href="#ref-Rstudio" role="doc-biblioref">RStudio Team 2020</a>)</span>.</p>
</section>
<section id="preparation" class="level3">
<h3 class="anchored" data-anchor-id="preparation">Preparation</h3>
<p>The data exported from Strava has the format gpx. The single activities are read and written into a data frame. IDs and descriptions for recognition are assigned to the single activities. The activities are then combined to one data frame and turned into a spatial object, which is then exported for manual classification. In QGIS <span class="citation" data-cites="QGIS_software">(<a href="#ref-QGIS_software" role="doc-biblioref">QGIS Development Team 2024</a>)</span>, every point is given either the attribute shopping, recreation or travel. The points are selected by location using an Open Street Map basemap. The activities are then again imported, turned into a spatial object and reprojected to LV95.</p>
</section>
<section id="attribute-based-classification" class="level3">
<h3 class="anchored" data-anchor-id="attribute-based-classification">Attribute-based classification</h3>
<p>For the attribute-based classification, the time-lag and distance between single locations are being calculated. These calculations are checked for outliers. As the time lag between two consecutive locations is mostly 1 s, all intervals bigger than 5 s are removed. All step lengths of more than 5 m are removed. As attributes also depend on the spatial scale, the mean step is calculated using the two previous and two next points. The speed is deducted from this mean step. The segmentation is done as described in <span class="citation" data-cites="laube_how_2011">Laube and Purves (<a href="#ref-laube_how_2011" role="doc-biblioref">2011</a>)</span>. The threshold for movement is set to 1.5 m. This is based on the assumption that this equals around 3 - 4 steps, which can be interpreted as movement. Additionally, acceleration was calculated based on speed and time lag. After the calculation of the attributes per trajectories, a summary is done for each trajectory to find differences between activity types. Also, a summary over all activities is done to find differences between activity types. This information was used to set the thresholds. Based on the established differences, a classification is done. The classification is verified using a confusion matrix and its statistic output. The thresholds for classification are adapted until the best possible classification is reached. The following figure shows the workflow for the attribute-based classification.<br>
<img src="abw.png" class="img-fluid" alt="workflow"></p>
</section>
<section id="cama-classification" class="level3">
<h3 class="anchored" data-anchor-id="cama-classification">CAMA classification</h3>
<p>This approach is based on the idea that the context of a walking activity allows a differentiation of its purpose. The context aware movement analysis (CAMA) based classification is derived from the context. For this the layers tlm_bb_bodenbedeckung, tlm_areale_nutzungsareal, tlm_strassen_strasse tlm_oev_haltestelle and tlm_bauten_gebaeude_footprint of the swissTLM3D <span class="citation" data-cites="bundesamt_fur_landestopografie_swisstlm3d_2022">(<a href="#ref-bundesamt_fur_landestopografie_swisstlm3d_2022" role="doc-biblioref">Landestopografie 2022</a>)</span> are used. For the first three layers a buffer of 10 m, for the fourth a buffer of 50 m and for the last layer no buffer is calculated. The layer tlm_strassen_strasse was reduced to streets of several categories (Ausfahrt, Einfahrt, Zufahrt, 3 m Strasse, 1 m Weg, 2 m Weg, 1 m Wegfragment and 2 m Wegfragment). For each layer a spatial join to the trajectories is performed. Then all single locations are classified using the following set of rules.<br>
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cama.png" class="img-fluid figure-img"></p>
<figcaption>workflow</figcaption>
</figure>
</div>
</section>
<section id="validation" class="level3">
<h3 class="anchored" data-anchor-id="validation">Validation</h3>
<p>Validation of the classification is based on validation methods described by <span class="citation" data-cites="rykiel_testing_1996">(<a href="#ref-rykiel_testing_1996" role="doc-biblioref">Rykiel 1996</a>)</span>. Methods use are visualization, comparison between the different approaches, internal validation and sensitivity analysis. The following process is applied to all previously described classification approaches. For every classification approach and dataset a confusion matrix is created and the associated statistics are calculated.<br>
<img src="validation.png" class="img-fluid" alt="workflow"></p>
</section>
<section id="cart-classification" class="level3">
<h3 class="anchored" data-anchor-id="cart-classification">CART classification</h3>
<p>Using a classification and regression tree (CART) algorithm in rpart <span class="citation" data-cites="therneau_rpart_2023">(<a href="#ref-therneau_rpart_2023" role="doc-biblioref">Therneau, Atkinson, and Ripley 2023</a>)</span> a decision tree is built using the default parameters for the training data with the attributes from the attribute based classification and the location attributes which were determined in the CAMA classification (speedMean, stepMean, acceleration, recreation, oev, gebaeude). The decision-tree is then applied to Saskia’s test-data and Sarah’s test-data independently.</p>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="attribute-based-classification-1" class="level3">
<h3 class="anchored" data-anchor-id="attribute-based-classification-1">Attribute based classification</h3>
<section id="training-data-saskia" class="level4">
<h4 class="anchored" data-anchor-id="training-data-saskia">Training data Saskia</h4>
<p>Despite extensive testing and adapting of the thresholds, it was not possible to correctly classify all activities. 49 out of 12’886 points could not be classified and were removed before computing the confusion matrix. 7’526 points were classified correctly, which leads to an overall accuracy of 59 %. Sensitivity is highest for the class travel (0.61). Detection rate is highest for travel (0.54).</p>
<div class="cell">
<details class="code-fold">
<summary>confusion matrix training data</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix for test data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_training, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#D6EAF8"</span>,<span class="at">high =</span> <span class="st">"#2E86C1"</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/confusion%20matrix-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for the training data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-data-saskia" class="level4">
<h4 class="anchored" data-anchor-id="activity-data-saskia">Activity data Saskia</h4>
<p>30 out of 6826 points could not be classified and were removed before computing the confusion matrix. 2270 points were classified correctly, leading to an overall accuracy of the model for Saskia’s activity data of 33 %. Again, sensitivity is highest for travel (0.34), as well as the detection rate (0.33).</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix for Saskias data</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_saskia, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#D6EAF8"</span>,<span class="at">high =</span> <span class="st">"#2E86C1"</span>)<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/confusion%20matrix%20Saskias%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for the test data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-data-sarah" class="level4">
<h4 class="anchored" data-anchor-id="activity-data-sarah">Activity data Sarah</h4>
<p>51 out of 17’061 points could not be classified and were removed before computing the confusion matrix. For Sarah’s activities, 3209 points are classified correctly. The accuracy of the model is 19 %. The sensitivity for recreation is highest (0.71), the detection rate is highest for travel (0.16). 95 % of the points are classified as travel.</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Sarahs data</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_sarah, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#D6EAF8"</span>,<span class="at">high =</span> <span class="st">"#2E86C1"</span>)<span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/confusion%20matrix%20Sarahs%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Sarah’s test data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cama-based-classification" class="level3">
<h3 class="anchored" data-anchor-id="cama-based-classification">CAMA based classification</h3>
<section id="training-data-saskia-1" class="level4">
<h4 class="anchored" data-anchor-id="training-data-saskia-1">Training data Saskia</h4>
<p>The overall accuracy with Saskia’s training data is 71%. The sensitivity (0.80) and detection rate (0.46) are highest for travel.</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Saskias training data</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_sas_tra_cama, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#FCF3CF"</span>,<span class="at">high =</span> <span class="st">"#F1C40F"</span>)<span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CAMA%20confusion%20matrix%20Saskias%20training%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Saskia’s training data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-data-saskia-1" class="level4">
<h4 class="anchored" data-anchor-id="activity-data-saskia-1">Activity data Saskia</h4>
<p>With Saskia’s test data the overall accuracy is 82%. The sensitivity (0.83) is highest for recreation and the detection rate (0.59) is highest for recreation as well.</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Saskias training data</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_sas_tes_cama, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#FCF3CF"</span>,<span class="at">high =</span> <span class="st">"#F1C40F"</span>)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CAMA%20confusion%20matrix%20Saskias%20test%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Saskia’s test data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-data-sarah-1" class="level4">
<h4 class="anchored" data-anchor-id="activity-data-sarah-1">Activity data Sarah</h4>
<p>The overall accuracy with Sarah’s activity data is 59%. With a sensitivity of 0.86 shopping is the most sensitive category. On the other hand the detection rate is highest for recreation (0.27).</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Saskias training data</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_sar_tes_cama, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#FCF3CF"</span>,<span class="at">high =</span> <span class="st">"#F1C40F"</span>)<span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CAMA%20confusion%20matrix%20Sarahs%20test%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Sarah’s test data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cart-based-classification" class="level3">
<h3 class="anchored" data-anchor-id="cart-based-classification">CART based classification</h3>
<section id="training-data-saskia-2" class="level4">
<h4 class="anchored" data-anchor-id="training-data-saskia-2">Training data Saskia</h4>
<p>The classification decision tree uses stepMean from the attribute based classification as well as the attributes recreation and pub_trans from the CAMA based classification.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot classification tree</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_sas_train)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(model_sas_train, <span class="at">cex=</span><span class="fl">0.8</span>,<span class="at">use.n =</span> <span class="cn">TRUE</span>, <span class="at">xpd =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CART%20tree%20based%20on%20Saskias%20training%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Classification decision tree. For the diversions recreation and pub_trans the number 1 corresponds to TRUE and the number 0 to FALSE. Therefore the left branch of the diversion recreation corresponds to sites, which had the attribute recreation in the CAMA analysis set to TRUE. The three numbers at each leaf correspond to the number of points of each of the attributed walking activity categories (recreation, shopping, travel).</figcaption>
</figure>
</div>
</div>
</div>
<p>With Saskia’s training data the overall accuracy is 77%. The most sensitive category is travel (0.79) and the highest detection rate is present for travel with (0.52).</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Saskias training data</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_cart_train, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#FADBD8"</span>,<span class="at">high =</span> <span class="st">"#E74C3C"</span>)<span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CART%20confusion%20matrix%20Saskias%20training%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Saskia’s training data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-data-saskia-2" class="level4">
<h4 class="anchored" data-anchor-id="activity-data-saskia-2">Activity data Saskia</h4>
<p>The overall accuracy is 55% for Saskia’s test data. Recreation has the highest sensitivity (0.81) and travel has the highest detection rate (0.31).</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Saskias training data</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_cart_test_sas, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#FADBD8"</span>,<span class="at">high =</span> <span class="st">"#E74C3C"</span>)<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CART%20confusion%20matrix%20Saskias%20test%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Saskia’s test data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-data-sarah-2" class="level4">
<h4 class="anchored" data-anchor-id="activity-data-sarah-2">Activity data Sarah</h4>
<p>For Sarah’s test data the overall accuracy is 47%. Sensitivity (0.85) and detection rate (0.19) are highest for shopping.</p>
<div class="cell">
<details class="code-fold">
<summary>Confusion matrix Saskias training data</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot confusion matrix</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(confus_cart_sar_test, <span class="at">type=</span><span class="st">"heatmap"</span>)<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"#FADBD8"</span>,<span class="at">high =</span> <span class="st">"#E74C3C"</span>)<span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">"frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/CART%20confusion%20matrix%20Sarahs%20test%20data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Confusion matrix for Sarah’s test data.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<section id="attribute-based-classification-2" class="level3">
<h3 class="anchored" data-anchor-id="attribute-based-classification-2">Attribute based classification</h3>
<p>Based on the calculated attributes step length, speed an acceleration, it was not possible to clearly distinguish between different walking purposes. Most difficult was the separation of recreation and travel. These activity types are very similar in their attributes. Generally, travel is faster than recreation, but there were some activities where the mean speed of a recreational walk was just as fast as those for travel purposes. Also, speed differs between people. This explains the higher misclassification rate with Sarah’s data. The points from shopping activity are less accurate, as the signal is often lost within the building. For classification it was assumed that speed and step length are either higher or lower than for the other purposes. It was not possible to find a clear pattern that represents shopping activity. It can be concluded that, it is not possible to clearly differentiate between shopping, travelling and walking for recreation. More information is needed, especially to differentiate between travel and recreation. In addition, the walking attributes differ not only between people but also between individual trajectories, which makes it more difficult to differentiate.</p>
</section>
<section id="cama-based-classification-1" class="level3">
<h3 class="anchored" data-anchor-id="cama-based-classification-1">CAMA based classification</h3>
<p>The CAMA based classification performed well on Saskia’s training dataset as well as Sarah’s testing dataset but even better on Saskia’s testing dataset. That a testing dataset outperforms a training dataset is in this case due to CAMA using a set of rules, which was not derived from the training data but our overall perception of the objects and land use an activity is associated with. The differences in performance between the datasets stem from the amount of points belonging to the activity type shopping in each dataset, which again have lower accuracy. Also for this analysis no points have been removed in preprocessing. This had reduced the amount of points associated with shopping, which again leads to a high inclusion of points with low accuracy. Whether the buffer sizes for this analysis have been optimal for this case remains unknown. As <span class="citation" data-cites="lee_effects_2019">Lee and Kwan (<a href="#ref-lee_effects_2019" role="doc-biblioref">2019</a>)</span> showed, the buffer size has a high influence on the classification on activity types. We have not included a sensitivity analysis for the influence of the buffer size, but recommend using one for a further study .</p>
</section>
<section id="cart-based-classification-1" class="level3">
<h3 class="anchored" data-anchor-id="cart-based-classification-1">CART based classification</h3>
<p>In the CART based classification a diminishing accuracy from Saskia’s training data, to Saskia’s testing data and Sarah’s testing data is present. This shows the importance of using a dataset of a sufficient size to build a model. Further the importance of using data from different people to build a model and catch individual characteristics and patterns is highlighted.</p>
</section>
<section id="overall-discussion" class="level3">
<h3 class="anchored" data-anchor-id="overall-discussion">Overall discussion</h3>
<p>• How well it possible to derive the type of activity from movement data considering the attributes sinuosity, speed and visited locations? The visited locations are best suited to derive the type of activity with an accuracy up to 82%. • Which type of analytical approach performs best in differentiating between the different activities? The context aware movement analysis is most successful at differentiating. • How does the performance of the analytical concepts differ when applied on trajectories recorded by different people? If the analytical concepts include differentiation based on training data, the performance is worse on people, who were not included in the training data. With small datasets for training also a risk of overfitting a model on the training data is present.</p>
<p>As described in a review by <span class="citation" data-cites="pearson_systematic_2024">Pearson et al. (<a href="#ref-pearson_systematic_2024" role="doc-biblioref">2024</a>)</span> overall a lack in consensus for the optimal reporting of GPS data is present, with studies often missing to report noise. In our group project the exported data did not contain any information on GPS accuracy, which shows how unimportant this information is perceived. This information could have been used to improve our analysis by not only providing information about the reliability of the data but also to identify locations within a building. As <span class="citation" data-cites="kim_new_2012">Kim et al. (<a href="#ref-kim_new_2012" role="doc-biblioref">2012</a>)</span> showed, the number of satellites can be used to asses, whether a point was documented within a building. Another option to improve the differentiation between indoor and outdoor activities could be the use of the walking period duration and continuity as in <span class="citation" data-cites="baroudi_classification_2024">Baroudi et al. (<a href="#ref-baroudi_classification_2024" role="doc-biblioref">2024</a>)</span> or record density and heading changes as described in <span class="citation" data-cites="berjisian_evaluation_2022">Berjisian and Bigazzi (<a href="#ref-berjisian_evaluation_2022" role="doc-biblioref">2022</a>)</span>. To conclude our analysis demonstrated the importance of context information in activity type detection.</p>
</section>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<section id="statement-of-authorship-for-student-work-at-the-school-of-life-sciences-and-facility-management" class="level3">
<h3 class="anchored" data-anchor-id="statement-of-authorship-for-student-work-at-the-school-of-life-sciences-and-facility-management">Statement of Authorship for Student Work at the School of Life Sciences and Facility Management</h3>
<p>By submitting the enclosed Project the student affirms independent completion of the(ir) work without outside help. The undersigned student declares that all printed and electronic sources used in the text and the bibliography are correctly indicated, i.e., that the work does not contain any plagiarism (no parts that have been taken in whole or in part from another’s or his/her own text or from another’s or his/her own work without clear identification and without stating the source). In the event of misconduct of any kind, Paragraph 39 and Paragraph 40 of the General Academic Regulations for Bachelor’s and Master’s degree programmes at the Zurich University of Applied Sciences (dated 29 January 2008) and the provisions of the Disciplinary Measures of the University Regulations shall apply.<br>
Saskia Gianola and Sarah Wirth</p>
</section>
<section id="wordcount" class="level3">
<h3 class="anchored" data-anchor-id="wordcount">Wordcount</h3>
<!-- after installing the wordcountadding, remove the line "#| eval: false" -->
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>wordcountaddin<span class="sc">::</span><span class="fu">word_count</span>(<span class="st">"index.qmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2349</code></pre>
</div>
</div>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-baroudi_classification_2024" class="csl-entry" role="listitem">
Baroudi, Loubna, Kira Barton, Stephen M. Cain, and K. Alex Shorter. 2024. <span>“Classification of Human Walking Context Using a Single-Point Accelerometer.”</span> <em>Scientific Reports</em> 14 (1): 3039. <a href="https://doi.org/10.1038/s41598-024-53143-8">https://doi.org/10.1038/s41598-024-53143-8</a>.
</div>
<div id="ref-berjisian_evaluation_2022" class="csl-entry" role="listitem">
Berjisian, Elmira, and Alexander Bigazzi. 2022. <span>“Evaluation of Methods to Distinguish Trips from Activities in Walking and Cycling <span>GPS</span> Data.”</span> <em>Transportation Research Part C: Emerging Technologies</em> 137 (April): 103588. <a href="https://doi.org/10.1016/j.trc.2022.103588">https://doi.org/10.1016/j.trc.2022.103588</a>.
</div>
<div id="ref-kim_new_2012" class="csl-entry" role="listitem">
Kim, Taehyun, Kiyoung Lee, Wonho Yang, and Seung Do Yu. 2012. <span>“A New Analytical Method for the Classification of Time–Location Data Obtained from the Global Positioning System (<span>GPS</span>).”</span> <em>Journal of Environmental Monitoring</em> 14 (8): 2270. <a href="https://doi.org/10.1039/c2em30190c">https://doi.org/10.1039/c2em30190c</a>.
</div>
<div id="ref-bundesamt_fur_landestopografie_swisstlm3d_2022" class="csl-entry" role="listitem">
Landestopografie, Bundesamt für. 2022. <span>“<span class="nocase">swissTLM3D</span>.”</span> <a href="https://www.swisstopo.admin.ch/de/landschaftsmodell-swisstlm3d">https://www.swisstopo.admin.ch/de/landschaftsmodell-swisstlm3d</a>.
</div>
<div id="ref-laube_how_2011" class="csl-entry" role="listitem">
Laube, Patrick, and Ross S. Purves. 2011. <span>“How Fast Is a Cow? <span>Cross</span>‐<span>Scale</span> <span>Analysis</span> of <span>Movement</span> <span>Data</span>.”</span> <em>Transactions in GIS</em> 15 (3): 401–18. <a href="https://doi.org/10.1111/j.1467-9671.2011.01256.x">https://doi.org/10.1111/j.1467-9671.2011.01256.x</a>.
</div>
<div id="ref-lee_effects_2019" class="csl-entry" role="listitem">
Lee, Kangjae, and Mei-Po Kwan. 2019. <span>“The <span>Effects</span> of <span>GPS</span>-<span>Based</span> <span>Buffer</span> <span>Size</span> on the <span>Association</span> Between <span>Travel</span> <span>Modes</span> and <span>Environmental</span> <span>Contexts</span>.”</span> <em>ISPRS International Journal of Geo-Information</em> 8 (11): 514. <a href="https://doi.org/10.3390/ijgi8110514">https://doi.org/10.3390/ijgi8110514</a>.
</div>
<div id="ref-pearson_systematic_2024" class="csl-entry" role="listitem">
Pearson, Amber L., Calvin Tribby, Catherine D. Brown, Jiue-An Yang, Karin Pfeiffer, and Marta M. Jankowska. 2024. <span>“Systematic Review of Best Practices for <span>GPS</span> Data Usage, Processing, and Linkage in Health, Exposure Science and Environmental Context Research.”</span> <em>BMJ Open</em> 14 (2): e077036. <a href="https://doi.org/10.1136/bmjopen-2023-077036">https://doi.org/10.1136/bmjopen-2023-077036</a>.
</div>
<div id="ref-QGIS_software" class="csl-entry" role="listitem">
QGIS Development Team. 2024. <em>QGIS Geographic Information System</em>. QGIS Association. <a href="https://www.qgis.org">https://www.qgis.org</a>.
</div>
<div id="ref-R" class="csl-entry" role="listitem">
R Core Team. 2024. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-Rstudio" class="csl-entry" role="listitem">
RStudio Team. 2020. <em>RStudio: Integrated Development Environment for r</em>. Boston, MA: RStudio, PBC. <a href="http://www.rstudio.com/">http://www.rstudio.com/</a>.
</div>
<div id="ref-rykiel_testing_1996" class="csl-entry" role="listitem">
Rykiel, Edward J. 1996. <span>“Testing Ecological Models: The Meaning of Validation.”</span> <em>Ecological Modelling</em> 90 (3): 229–44. <a href="https://doi.org/10.1016/0304-3800(95)00152-2">https://doi.org/10.1016/0304-3800(95)00152-2</a>.
</div>
<div id="ref-therneau_rpart_2023" class="csl-entry" role="listitem">
Therneau, Terry, Beth Atkinson, and Brian Ripley. 2023. <span>“Rpart: <span>Recursive</span> <span>Partitioning</span> and <span>Regression</span> <span>Trees</span>.”</span> <a href="https://cran.r-project.org/web/packages/rpart/index.html">https://cran.r-project.org/web/packages/rpart/index.html</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>